import"./momentConfig-CRRUd3EM.js";import{q as h,s as k,b as x,o as i,c as v,w as y,d as t,f as l,x as R,t as g,h as _,j as q,y as N,r as V,z as $,_ as b,g as L,v as j,A as B,u as D,B as U,p as F,i as I,F as S}from"./index-BXMH6y3x.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{F as A}from"./fuse-CcLD0YPK.js";import{_ as O}from"./UserLayout-ol4tnCCV.js";const T={class:"h-16 w-16 rounded-full overflow-hidden shrink-0 border border-main-black"},E={class:"hidden md:flex flex-col justify-around h-full flex-grow min-w-0"},H={class:"flex flex-row gap-1 items-center justify-between"},W={class:"text-lg font-semibold truncate"},Y={class:"text-main-white/50 text-sm whitespace-nowrap"},G={key:0,class:"flex flex-row gap-1 items-center justify-start text-main-white/50"},J={class:"text-base whitespace-nowrap"},K={class:"text-base truncate"},P={__name:"Chat",props:{id:{type:String,required:!0},isSelected:{type:Boolean,required:!0},lastMessage:{type:Object,required:!1},companion:{type:Object,required:!0}},setup(p){const s=p,c=h(()=>{const o=s.lastMessage.timestamp.toDate(),e=k(),n=k(o),a=e.diff(n,"minutes"),d=e.diff(n,"hours"),u=e.diff(n,"days"),w=e.diff(n,"weeks"),m=e.diff(n,"years");return a<1?"только что":a<60?`${a}м`:d<24?`${d}ч`:u<7?`${u}д`:w<52?`${w}н`:`${m}г`});return(o,e)=>{const n=x("RouterLink");return i(),v(n,{to:{name:"chat-details",params:{chatId:s.id}},class:N(["flex flex-row h-20 p-2 items-center justify-center gap-2 rounded-lg",s.isSelected?"bg-main-gray":"hover:bg-main-gray transition"])},{default:y(()=>[t("div",T,[l(R,{url:s.companion.imageURL,loadingIcon:"user"},null,8,["url"])]),t("div",E,[t("div",H,[t("span",W,g(s.companion.displayName),1),t("span",Y,g(c.value),1)]),s.lastMessage?(i(),_("div",G,[t("span",J,g(s.lastMessage.sender.displayName)+": ",1),t("span",K,g(s.lastMessage.content.value),1)])):q("",!0)])]),_:1},8,["to","class"])}}},Q={},X={class:"flex h-20 w-full rounded-lg bg-main-gray animate-pulse"};function Z(p,s){return i(),_("div",X)}const ee=z(Q,[["render",Z]]),te={class:"flex flex-row h-12 w-full items-center gap-2 p-2 border-2 border-main-gray text-main-gray rounded-full transition-colors focus-within:border-main-white focus-within:bg-main-gray focus-within:text-main-white"},se=["placeholder"],ae={__name:"SearchInput",props:{placeholder:{type:String,required:!0},modelValue:{type:String,default:""}},emits:["update:modelValue"],setup(p,{emit:s}){const c=s,o=p,e=V(o.modelValue);$(()=>o.modelValue,a=>{a!==e.value&&(e.value=a)}),$(e,a=>{c("update:modelValue",a)});const n=()=>{e.value=""};return(a,d)=>(i(),_("div",te,[t("div",null,[l(b,{iconName:"SearchIcon",class:"fill-current h-6 w-6"})]),L(t("input",{"onUpdate:modelValue":d[0]||(d[0]=u=>e.value=u),type:"text",spellcheck:"false",class:"w-full h-full outline-none bg-transparent text-main-white placeholder:text-main-white/50",placeholder:o.placeholder},null,8,se),[[j,e.value,void 0,{trim:!0}]]),t("button",{onClick:n},[l(b,{iconName:"CloseIcon",class:"fill-current h-6 w-6"})])]))}},ne={class:"flex flex-row w-full h-full"},oe={class:"flex flex-col h-full w-24 md:w-1/3 border-r-2 border-main-gray pr-2 gap-2"},re={class:"flex flex-col gap-2 h-full overflow-y-auto overflow-x-hidden"},le={class:"pl-2 flex-1"},fe={__name:"index",setup(p){const s=U(),c=B(),o=D(),e=h(()=>o.currentUserId),n=m=>m.find(f=>f.id!==e.value),a=V(""),d=h(()=>new A(c.chats,{keys:[{name:"participants.displayName",weight:.7},{name:"messages.content.value",weight:.5}],threshold:.3,minMatchCharLength:2,includeMatches:!0,shouldSort:!0,distance:100,location:0})),u=h(()=>a.value.trim()?d.value.search(a.value).map(m=>m.item):c.chats),w=h(()=>s.params.chatId?s.params.chatId:null);return(m,f)=>{const C=x("RouterLink"),M=x("RouterView");return i(),v(O,null,{default:y(()=>[t("div",ne,[t("div",oe,[l(C,{to:{name:"chats-empty"},class:"hidden md:flex flex-row gap-2 items-center"},{default:y(()=>[l(b,{iconName:"MessageIcon",class:"fill-main-white w-9 h-9"}),f[1]||(f[1]=t("span",{class:"text-main-white text-4xl font-bold tracking-tight truncate"},"Чаты",-1))]),_:1}),l(ae,{class:"hidden md:flex",modelValue:a.value,"onUpdate:modelValue":f[0]||(f[0]=r=>a.value=r),placeholder:"Поиск"},null,8,["modelValue"]),t("div",re,[F(c).isInitialLoading?(i(),_(S,{key:0},I(5,r=>l(ee)),64)):(i(!0),_(S,{key:1},I(u.value,r=>(i(),v(P,{key:r.id,id:r.id,isSelected:w.value===r.id,lastMessage:r.lastMessage,companion:n(r.participants)},null,8,["id","isSelected","lastMessage","companion"]))),128))])]),t("div",le,[l(M)])])]),_:1})}}};export{fe as default};
