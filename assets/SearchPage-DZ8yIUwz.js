import{b as ee,o as f,h as v,f as w,w as S,x as te,d as o,k as se,t as Q,m as ae,V as le,r as P,q as U,n as ne,z as re,c as C,a as ie,B as oe,_ as H,g as ue,v as ce,i as R,p as z,y as de,F as G,j}from"./index-C3zZXPKa.js";import{u as fe,_ as me}from"./UserLayout-rlzKpuvz.js";import{_ as pe}from"./Track-CLAGqUZY.js";import{_ as he}from"./AlbumCard-DcMSHC3x.js";import{C as W}from"./CardsGrid-BDJImdvi.js";import"./lodash-BUlOZx_2.js";import{F as ge}from"./fuse-CcLD0YPK.js";import{g as ve,n as K,b as D,A as we,S as xe,a as be}from"./swiper-vue-7JpFHPxv.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";function ye(X){let{swiper:e,extendParams:b,on:M,emit:y}=X;const Y=ve();b({mousewheel:{enabled:!1,releaseOnEdges:!1,invert:!1,forceToAxis:!1,sensitivity:1,eventsTarget:"container",thresholdDelta:null,thresholdTime:null,noMousewheelClass:"swiper-no-mousewheel"}}),e.mousewheel={enabled:!1};let T,_=D(),m;const r=[];function h(t){let l=0,u=0,a=0,d=0;return"detail"in t&&(u=t.detail),"wheelDelta"in t&&(u=-t.wheelDelta/120),"wheelDeltaY"in t&&(u=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(l=-t.wheelDeltaX/120),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(l=u,u=0),a=l*10,d=u*10,"deltaY"in t&&(d=t.deltaY),"deltaX"in t&&(a=t.deltaX),t.shiftKey&&!a&&(a=d,d=0),(a||d)&&t.deltaMode&&(t.deltaMode===1?(a*=40,d*=40):(a*=800,d*=800)),a&&!l&&(l=a<1?-1:1),d&&!u&&(u=d<1?-1:1),{spinX:l,spinY:u,pixelX:a,pixelY:d}}function B(){e.enabled&&(e.mouseEntered=!0)}function O(){e.enabled&&(e.mouseEntered=!1)}function N(t){return e.params.mousewheel.thresholdDelta&&t.delta<e.params.mousewheel.thresholdDelta||e.params.mousewheel.thresholdTime&&D()-_<e.params.mousewheel.thresholdTime?!1:t.delta>=6&&D()-_<60?!0:(t.direction<0?(!e.isEnd||e.params.loop)&&!e.animating&&(e.slideNext(),y("scroll",t.raw)):(!e.isBeginning||e.params.loop)&&!e.animating&&(e.slidePrev(),y("scroll",t.raw)),_=new Y.Date().getTime(),!1)}function g(t){const s=e.params.mousewheel;if(t.direction<0){if(e.isEnd&&!e.params.loop&&s.releaseOnEdges)return!0}else if(e.isBeginning&&!e.params.loop&&s.releaseOnEdges)return!0;return!1}function I(t){let s=t,p=!0;if(!e.enabled||t.target.closest(`.${e.params.mousewheel.noMousewheelClass}`))return;const c=e.params.mousewheel;e.params.cssMode&&s.preventDefault();let l=e.el;e.params.mousewheel.eventsTarget!=="container"&&(l=document.querySelector(e.params.mousewheel.eventsTarget));const u=l&&l.contains(s.target);if(!e.mouseEntered&&!u&&!c.releaseOnEdges)return!0;s.originalEvent&&(s=s.originalEvent);let a=0;const d=e.rtlTranslate?-1:1,n=h(s);if(c.forceToAxis)if(e.isHorizontal())if(Math.abs(n.pixelX)>Math.abs(n.pixelY))a=-n.pixelX*d;else return!0;else if(Math.abs(n.pixelY)>Math.abs(n.pixelX))a=-n.pixelY;else return!0;else a=Math.abs(n.pixelX)>Math.abs(n.pixelY)?-n.pixelX*d:-n.pixelY;if(a===0)return!0;c.invert&&(a=-a);let x=e.getTranslate()+a*c.sensitivity;if(x>=e.minTranslate()&&(x=e.minTranslate()),x<=e.maxTranslate()&&(x=e.maxTranslate()),p=e.params.loop?!0:!(x===e.minTranslate()||x===e.maxTranslate()),p&&e.params.nested&&s.stopPropagation(),!e.params.freeMode||!e.params.freeMode.enabled){const i={time:D(),delta:Math.abs(a),direction:Math.sign(a),raw:t};r.length>=2&&r.shift();const E=r.length?r[r.length-1]:void 0;if(r.push(i),E?(i.direction!==E.direction||i.delta>E.delta||i.time>E.time+150)&&N(i):N(i),g(i))return!0}else{const i={time:D(),delta:Math.abs(a),direction:Math.sign(a)},E=m&&i.time<m.time+500&&i.delta<=m.delta&&i.direction===m.direction;if(!E){m=void 0;let k=e.getTranslate()+a*c.sensitivity;const Z=e.isBeginning,J=e.isEnd;if(k>=e.minTranslate()&&(k=e.minTranslate()),k<=e.maxTranslate()&&(k=e.maxTranslate()),e.setTransition(0),e.setTranslate(k),e.updateProgress(),e.updateActiveIndex(),e.updateSlidesClasses(),(!Z&&e.isBeginning||!J&&e.isEnd)&&e.updateSlidesClasses(),e.params.loop&&e.loopFix({direction:i.direction<0?"next":"prev",byMousewheel:!0}),e.params.freeMode.sticky){clearTimeout(T),T=void 0,r.length>=15&&r.shift();const $=r.length?r[r.length-1]:void 0,V=r[0];if(r.push(i),$&&(i.delta>$.delta||i.direction!==$.direction))r.splice(0);else if(r.length>=15&&i.time-V.time<500&&V.delta-i.delta>=1&&i.delta<=6){const F=a>0?.8:.2;m=i,r.splice(0),T=K(()=>{e.destroyed||!e.params||e.slideToClosest(e.params.speed,!0,void 0,F)},0)}T||(T=K(()=>{if(e.destroyed||!e.params)return;const F=.5;m=i,r.splice(0),e.slideToClosest(e.params.speed,!0,void 0,F)},500))}if(E||y("scroll",s),e.params.autoplay&&e.params.autoplayDisableOnInteraction&&e.autoplay.stop(),c.releaseOnEdges&&(k===e.minTranslate()||k===e.maxTranslate()))return!0}}return s.preventDefault?s.preventDefault():s.returnValue=!1,!1}function q(t){let s=e.el;e.params.mousewheel.eventsTarget!=="container"&&(s=document.querySelector(e.params.mousewheel.eventsTarget)),s[t]("mouseenter",B),s[t]("mouseleave",O),s[t]("wheel",I)}function L(){return e.params.cssMode?(e.wrapperEl.removeEventListener("wheel",I),!0):e.mousewheel.enabled?!1:(q("addEventListener"),e.mousewheel.enabled=!0,!0)}function A(){return e.params.cssMode?(e.wrapperEl.addEventListener(event,I),!0):e.mousewheel.enabled?(q("removeEventListener"),e.mousewheel.enabled=!1,!0):!1}M("init",()=>{!e.params.mousewheel.enabled&&e.params.cssMode&&A(),e.params.mousewheel.enabled&&L()}),M("destroy",()=>{e.params.cssMode&&L(),e.mousewheel.enabled&&A()}),Object.assign(e.mousewheel,{enable:L,disable:A})}const _e={class:"flex flex-col w-[250px] h-[300px] p-2 flex-shrink-0 hover:scale-105 transition-all"},Te={class:"flex w-full items-center justify-center py-2"},Ee={__name:"ArtistCard",props:{artist:{type:String,required:!0},artistId:{type:String,required:!0},imageURL:{type:String,default:null}},setup(X){const e=X;return(b,M)=>{const y=ee("RouterLink");return f(),v("div",_e,[w(y,{to:{name:"artist",params:{artistId:e.artistId}},class:"rounded-full overflow-hidden"},{default:S(()=>[w(te,{url:e.imageURL,loadingIcon:"user"},null,8,["url"])]),_:1},8,["to"]),o("div",Te,[w(y,{to:{name:"artist",params:{artistId:e.artistId}},class:"text-main-black dark:text-white font-semibold truncate hover:underline underline-offset-1"},{default:S(()=>[se(Q(e.artist),1)]),_:1},8,["to"])])])}}},ke={class:"flex h-full flex-col gap-4"},Se={class:"flex flex-row h-12 w-full items-center gap-2 p-2 border-2 border-main-gray text-main-gray rounded-full transition-colors focus-within:border-main-white focus-within:bg-main-gray focus-within:text-main-white"},Me={class:"flex flex-col gap-4"},Ie=["onClick"],Le={key:0,class:"flex-1 items-center justify-center"},Ae={class:"flex flex-col items-center gap-4"},Pe={key:1,class:"flex flex-1 h-full items-center justify-center"},Ce={class:"flex flex-col items-center gap-4"},De={key:2,class:"flex flex-col gap-6"},Xe={key:0,class:"flex flex-col gap-2"},Ne={key:1,class:"flex flex-col gap-2"},qe={key:2,class:"flex flex-col gap-2"},je={__name:"SearchPage",setup(X){const e=ie(),b=oe(),M=fe(),y=ae(),Y=le(),T=[we,ye],_=P(!0),m=P(""),r=P([]),h=P([]),B=P([{label:"Поп-музыка",value:"pop"},{label:"Рэп и хип-хоп",value:"rap-hip-hop"},{label:"Танцевальная",value:"dance"},{label:"Классическая",value:"classic"},{label:"Блюз",value:"blues"},{label:"Панк",value:"punk"},{label:"R&B",value:"r-b"},{label:"Другое",value:"other"}]),O=async()=>{const t=M.getAllTracks(),s=y.getAllAlbums(),p=Y.getAllArtists(),[c,l,u]=await Promise.all([t,s,p]);r.value=[...c.map(a=>({...a,type:"track"})),...l.map(a=>({...a,type:"album"})),...u.map(a=>({...a,type:"artist"}))]},N=U(()=>new ge(r.value,{keys:[{name:"title",weight:.7},{name:"displayName",weight:.8},{name:"author.displayName",weight:.5},{name:"description",weight:.3},{name:"album.title",weight:.4},{name:"album.description",weight:.2},{name:"author.description",weight:.1}],threshold:.3,distance:100,minMatchCharLength:1,shouldSort:!0,includeMatches:!0,includeScore:!0})),g=U(()=>{let t=r.value;m.value.trim()&&(t=N.value.search(m.value).map(l=>l.item)),h.value.length>0&&(t=t.filter(l=>h.value.includes(l.genre)));const s=t.filter(l=>l.type==="track").slice(0,10),p=t.filter(l=>l.type==="album").slice(0,10),c=t.filter(l=>l.type==="artist").slice(0,10);return{tracks:s||[],albums:p||[],artists:c||[]}}),I=U(()=>{var t,s,p,c,l,u;return((s=(t=g.value)==null?void 0:t.artists)==null?void 0:s.length)>0||((c=(p=g.value)==null?void 0:p.tracks)==null?void 0:c.length)>0||((u=(l=g.value)==null?void 0:l.albums)==null?void 0:u.length)>0});ne(async()=>{try{_.value=!0,b.query.request&&(m.value=b.query.request),b.query.genres&&(h.value=b.query.genres),await O()}catch(t){console.log(t)}finally{_.value=!1}});const q=()=>{m.value=""};re([m,h],([t,s])=>{const p={...b.query,request:t.trim()!==""?t:void 0,genres:s.length>0?s:void 0};e.replace({query:p})},{immediate:!1});const L=t=>{h.value.includes(t)?h.value=h.value.filter(s=>s!==t):h.value=[...h.value,t]},A=t=>h.value.includes(t);return(t,s)=>(f(),C(me,null,{default:S(()=>{var p,c,l,u,a,d;return[o("div",ke,[s[6]||(s[6]=o("div",null,[o("h1",{class:"text-4xl font-bold tracking-tight truncate"}," Поиск ")],-1)),o("div",Se,[o("div",null,[w(H,{iconName:"SearchIcon",class:"fill-current h-6 w-6"})]),ue(o("input",{"onUpdate:modelValue":s[0]||(s[0]=n=>m.value=n),type:"text",spellcheck:"false",class:"w-full h-full outline-none bg-transparent text-main-white placeholder:text-main-white/50",placeholder:"Треки, альбомы, исполнители"},null,512),[[ce,m.value]]),o("button",{onClick:q},[w(H,{iconName:"CloseIcon",class:"fill-current h-6 w-6"})])]),o("div",Me,[w(z(xe),{"space-between":16,modules:T,"slides-per-view":"auto",class:"w-full",mousewheel:!0},{default:S(()=>[(f(!0),v(G,null,R(B.value,n=>(f(),C(z(be),{key:n.value,class:"!w-fit"},{default:S(()=>[o("button",{onClick:x=>L(n.value),class:de(["px-4 py-2 bg-main-gray rounded-full transition hover:scale-95",A(n.value)?"bg-main-white/20":"bg-main-gray"])},Q(n.label),11,Ie)]),_:2},1024))),128))]),_:1}),_.value?(f(),v("div",Le,[o("div",Ae,[w(H,{iconName:"ProgressActivityIcon",class:"h-16 w-16 fill-current"}),s[1]||(s[1]=o("div",{class:"flex flex-col items-center gap-2"},[o("span",{class:"text-2xl font-bold"},"Загрузка...")],-1))])])):!_.value&&!I.value?(f(),v("div",Pe,[o("div",Ce,[w(H,{iconName:"SearchOffIcon",class:"h-16 w-16 fill-current"}),s[2]||(s[2]=o("div",{class:"flex flex-col items-center gap-2"},[o("span",{class:"text-2xl font-bold"},"Ничего не найдено"),o("span",{class:"text-main-white/50"},"Попробуйте изменить запрос")],-1))])])):(f(),v("div",De,[((c=(p=g.value)==null?void 0:p.tracks)==null?void 0:c.length)>0?(f(),v("div",Xe,[s[3]||(s[3]=o("h2",{class:"text-xl font-bold"},"Треки",-1)),(f(!0),v(G,null,R(g.value.tracks,n=>(f(),C(pe,{key:n.id,data:n,isShowImage:!0,list:g.value.tracks.map(x=>x.id)},null,8,["data","list"]))),128))])):j("",!0),((u=(l=g.value)==null?void 0:l.albums)==null?void 0:u.length)>0?(f(),v("div",Ne,[s[4]||(s[4]=o("h2",{class:"text-xl font-bold"},"Альбомы",-1)),w(W,null,{default:S(()=>[(f(!0),v(G,null,R(g.value.albums,n=>(f(),C(he,{album:n,key:n.id},null,8,["album"]))),128))]),_:1})])):j("",!0),((d=(a=g.value)==null?void 0:a.artists)==null?void 0:d.length)>0?(f(),v("div",qe,[s[5]||(s[5]=o("h2",{class:"text-xl font-bold"},"Исполнители",-1)),w(W,null,{default:S(()=>[(f(!0),v(G,null,R(g.value.artists,n=>(f(),C(Ee,{key:n.id,artist:n.displayName,artistId:n.id,imageURL:n.imageURL},null,8,["artist","artistId","imageURL"]))),128))]),_:1})])):j("",!0)]))])])]}),_:1}))}};export{je as default};
