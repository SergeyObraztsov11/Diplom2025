import{u as J,a2 as ve,Q as fe,r as h,n as ne,a3 as oe,b as se,o as R,h as E,d,F as xe,i as he,c as ie,w as D,f as i,_ as le,g as H,t as U,a1 as Y,y as X,x as ce,p as u,R as S,S as ue,a4 as pe,O as de,P as ke,q as w,D as j,a5 as Z,a6 as ge,a7 as we,J as G,I as K,E as ee,G as te,a8 as ae,H as V,j as me,k as ye,a9 as Te,a as be,v as _e,l as Ce}from"./index-CUkGl-i6.js";const Ie={class:"flex flex-col w-full items-center"},Ne={class:"flex flex-row w-full items-center justify-center mt-auto"},Se={class:"h-10 w-10 overflow-hidden rounded-full flex-shrink-0"},W=80,Le=300,re=140,Fe={__name:"AppHeader",setup(s){const a=J(),e=ve(),k=fe(),m=h([{icon:"HomeIcon",text:"Главная",to:{name:"home"}},{icon:"SearchIcon",text:"Поиск",to:{name:"search"}},{icon:"FavoriteFillIcon",text:"Мне нравится",to:{name:"liked_tracks"}},{icon:"MessageIcon",text:"Сообщения",to:{name:"chats-empty"}}]),r=h(80),n=h(!1),y=()=>{k.openModal("profile")},N=()=>{e.toggleTheme()},_=()=>{k.openModal("createAlbum")},o=async()=>{await a.logoutUser()},l=b=>{b.preventDefault();const c=b.clientX,f=r.value;function v(P){const O=f+(P.clientX-c);r.value=Math.min(Math.max(O,W),Le),n.value=r.value>re}function I(){document.removeEventListener("mousemove",v),document.removeEventListener("mouseup",I),r.value<re?(r.value=W,n.value=!1):(r.value=Math.max(r.value,240),n.value=!0)}document.addEventListener("mousemove",v),document.addEventListener("mouseup",I)},T=()=>{window.innerWidth<768&&(r.value=W,n.value=!1)};return ne(()=>{T(),window.addEventListener("resize",T)}),oe(()=>{window.removeEventListener("resize",T)}),(b,c)=>{const f=se("RouterLink");return R(),E("header",{class:"h-screen flex flex-col px-2 items-center dark:bg-main-black select-none relative divide-y-2 divide-main-gray",style:pe({width:`${r.value}px`})},[d("div",{class:"absolute right-0 top-0 h-full w-1 cursor-col-resize bg-main-gray hover:bg-main-white/20 transition-all",onMousedown:l},null,32),d("nav",Ie,[(R(!0),E(xe,null,he(m.value,v=>(R(),ie(f,{key:v.to.name,to:v.to,title:v.text,class:X(["flex flex-row h-16 w-full text-base items-center gap-4 hover:text-white font-medium p-2 transition-all rounded-xl",[{"justify-center":!n.value},b.$route.name===v.to.name?"text-white bg-main-gray/20":"text-main-white/50"]])},{default:D(()=>[i(le,{iconName:v.icon,class:"fill-current h-6 w-6"},null,8,["iconName"]),H(d("span",{class:"truncate font-medium"},U(v.text),513),[[Y,n.value]])]),_:2},1032,["to","title","class"]))),128))]),d("div",Ne,[i(ue,{placement:"top-right",class:"w-full"},{trigger:D(()=>{var v,I;return[d("button",{class:X(["flex flex-row h-16 w-full text-base items-center justify-center gap-4 text-main-white/80 hover:text-white font-medium p-2 transition-all rounded-xl",{"justify-center":!n.value}])},[d("div",Se,[i(ce,{loadingIcon:"user",url:(v=u(a).currentUserData)==null?void 0:v.imageURL},null,8,["url"])]),H(d("span",{class:"truncate transition-all"},U((I=u(a).currentUserData)==null?void 0:I.displayName),513),[[Y,n.value]])],2)]}),content:D(()=>[i(S,{onClick:y,iconName:"PersonIcon",text:"Профиль"}),i(S,{onClick:_,iconName:"AddIcon",text:"Создать альбом"}),i(S,{onClick:N,iconName:u(e).currentTheme==="dark"?"LightModeIcon":"DarkModeIcon",text:u(e).currentTheme==="dark"?"Светлая":"Темная"},null,8,["iconName","text"]),i(S,{onClick:o,isRed:!0,iconName:"LogoutIcon",text:"Выход"})]),_:1})])],4)}}},De=de("tracks",()=>{const s=ke(),a=J(),e=async o=>{const l=j(s,"users",a.currentUserId);await Z(l,{likedTracks:ge(o)})},k=async o=>{const l=j(s,"users",a.currentUserId);await Z(l,{likedTracks:we(o)})},m=w(()=>{var o;return(o=a.currentUserData)==null?void 0:o.likedTracks}),r=async o=>{const l=o.data(),T=o.id,b=await G(l.author),c={id:b.id,...b.data()},f=await G(l.album),v={id:f.id,...f.data()};return{id:T,ref:o.ref,...l,author:c,album:v}};return{likedTracks:m,likeTrack:e,dislikeTrack:k,getLikedTracks:async()=>{const o=m.value;if(!(o.length>0))return[];const l=await K(ee(V(s,"tracks"),te(ae(),"in",o)));return l.empty?[]:await Promise.all(l.docs.map(r))},getTrackById:async o=>{const l=j(s,"tracks",o),T=await G(l);return await r(T)},getTracksById:async o=>{const l=await K(ee(V(s,"tracks"),te(ae(),"in",o)));return l.empty?[]:await Promise.all(l.docs.map(r))},getTrackDetails:r,getAllTracks:async()=>{const o=await K(V(s,"tracks"));return await Promise.all(o.docs.map(r))}}}),Re=de("player",()=>{const s=De(),a=J(),e=h(!1),k=h(!0),m=h(null),r=h([]),n=h(new Audio),y=h(!1),N=h(!1),_=w(()=>{var t;return r.value.indexOf((t=m.value)==null?void 0:t.id)}),o=w(()=>!r.value||!m.value?!1:_.value===r.value.length-1),l=w(()=>!r.value||!m.value?!1:_.value===0),T=w(()=>m.value?a.currentUserData.likedTracks.includes(m.value.id):!1),b=async()=>{const t=m.value.id;T.value?await s.dislikeTrack(t):await s.likeTrack(t)},c={OFF:"OFF",ON:"ON",SINGLE_TRACK:"SINGLE_TRACK"},f=h(c.OFF),v=()=>{switch(f.value){case c.OFF:{f.value=c.ON;break}case c.ON:{f.value=c.SINGLE_TRACK;break}case c.SINGLE_TRACK:{f.value=c.OFF;break}default:{f.value=c.OFF;break}}},I=async({id:t,trackList:x})=>{r.value=x,p(t||x[0])},P=()=>{const t=_.value,x=o.value,C=f.value,$=q(t,x,C);$!==null&&p(r.value[$])},O=()=>{const t=_.value,x=l.value,C=f.value,$=g(t,x,C);$!==null&&p(r.value[$])},q=(t,x,C)=>C===c.SINGLE_TRACK?t:C===c.ON?x?0:t+1:C===c.OFF&&!x?t+1:null,g=(t,x,C)=>C===c.SINGLE_TRACK?t:C===c.ON?x?r.value.length-1:t-1:C===c.OFF?x?null:t-1:(console.log("Достигнуто начало плейлиста"),null),p=async t=>{k.value=!0;try{const x=await s.getTrackById(t);x&&(m.value=x,e.value=!0,n.value.src=x.audioURL,n.value.addEventListener("ended",()=>P()),n.value.load(),await n.value.play(),y.value=!1)}catch{y.value=!0}finally{k.value=!1}},L=h(0),A=h(0),z=h(!1),M=w({get:()=>z.value,set:t=>{n.value.volume=t?0:Q.value,z.value=t}}),B=h(.5),Q=w({get:()=>B.value,set:t=>{n.value&&(n.value.volume=t),M.value=!1,B.value=t}});return{isCurrentTrackFirst:l,isCurrentTrackLast:o,currentTrackIndex:_,isLiked:T,likeToggle:b,isPlayerOpen:e,currentTrackData:m,isLoading:k,isPaused:y,volume:Q,isShuffle:N,playTrack:p,pauseCurrentTrack:()=>{n.value&&(n.value.pause(),y.value=!0)},resumeCurrentTrack:()=>{n.value&&(n.value.play(),y.value=!1)},updateCurrentTime:()=>{n.value&&(L.value=n.value.currentTime,A.value=n.value.duration)},audioDuration:A,audioCurrentTime:L,setCurrentTime:t=>{n.value.currentTime=t},playTrackList:I,playNextTrack:P,playPreviousTrack:O,isMuted:M,currentLoopStatus:f,loopStatuses:c,loopStatusToggle:v}}),Pe=["type"],F={__name:"BaseButton",props:{type:{type:String,validator:s=>["default","primary","text","hovering"].some(a=>a===s),default:"default",required:!1},action:{type:String,validator:s=>["default","disabled","danger"].some(a=>a===s),default:"default",required:!1},isRounded:{type:Boolean,default:!1,required:!1},iconName:{type:String,required:!1},text:{type:String,required:!1},size:{type:String,validator:s=>["xs","sm","md","lg","xl","2xl","3xl","4xl","5xl","6xl"].includes(s),default:"md",required:!1},formType:{type:String,validator:s=>["button","submit","reset"].some(a=>a===s),default:"button",required:!1},isReversed:{type:Boolean,default:!1,required:!1}},setup(s){const a=s,e={default:{primary:"text-white dark:text-main-white border-main-color bg-main-color hover:bg-main-color/90",default:"border-main-white dark:border-main-gray hover:bg-main-white dark:hover:bg-main-gray",hovering:"border-transparent  hover:bg-main-white dark:hover:bg-main-gray",text:"text-main-gray dark:text-main-white hover:text-main-gray/60 dark:hover:text-main-white/60 border-transparent"},danger:{primary:"text-white dark:text-main-white border-main-error-red bg-main-error-red hover:bg-main-error-red/90",default:"text-main-error-red border-main-error-red hover:bg-main-white dark:hover:bg-main-gray",hovering:"text-main-error-red border-transparent  hover:bg-main-white dark:hover:bg-main-gray",text:"text-main-error-red hover:text-main-error-red/60 border-transparent"},disabled:{primary:"text-white dark:text-main-black border-main-white dark:border-main-gray bg-main-white dark:bg-main-gray",default:"text-main-white dark:text-main-gray border-main-white dark:border-main-gray ",hovering:"text-main-white dark:text-main-gray border-transparent",text:"text-main-white dark:text-main-white/50 border-transparent"}},k={xs:{text:"text-xs",icon:"h-3 w-3"},sm:{text:"text-sm",icon:"h-4 w-4"},md:{text:"text-base",icon:"h-5 w-5"},lg:{text:"text-lg",icon:"h-6 w-6"},xl:{text:"text-xl",icon:"h-7 w-7"},"2xl":{text:"text-2xl",icon:"h-8 w-8"},"3xl":{text:"text-3xl",icon:"h-9 w-9"},"4xl":{text:"text-4xl",icon:"h-10 w-10"},"5xl":{text:"text-5xl",icon:"h-11 w-11"},"6xl":{text:"text-6xl",icon:"h-14 w-14"}},m=w(()=>e[a.action][a.type]),r=w(()=>a.isRounded?"rounded-full":"rounded-lg"),n=w(()=>k[a.size].text),y=w(()=>k[a.size].icon);return(N,_)=>(R(),E("button",Te(N.$attrs,{class:["flex flex-row items-center justify-start max-w-full p-2 gap-1 border-2 transition-all truncate overflow-hidden whitespace-nowrap",[r.value,m.value,n.value,{"hover:scale-105":a.action!=="disabled"},{"flex-row-reverse":s.isReversed}]],type:a.formType}),[a.iconName?(R(),ie(le,{key:0,iconName:a.iconName,class:X(["fill-current",[y.value]])},null,8,["iconName","class"])):me("",!0),ye(" "+U(a.text),1)],16,Pe))}},Oe={key:0,class:"sticky bottom-0 left-0 right-0 bg-white dark:bg-main-black z-10 backdrop-blur-sm"},Ae=["max","value"],ze={class:"flex flex-row items-center p-2 gap-4 md:grid md:grid-cols-[1fr_auto_1fr] md:gap-2"},Me={class:"flex items-center gap-2 flex-grow md:flex-grow-0 min-w-0 md:min-w-[180px]"},$e={class:"h-20 w-20 rounded-md overflow-hidden flex-shrink-0"},Ee={class:"flex flex-col justify-center min-w-0"},Ue={class:"font-semibold text-lg truncate block hover:text-white"},Be={class:"truncate block hover:underline"},qe={class:"flex items-center gap-1 flex-shrink-0 ml-auto md:ml-0"},je={class:"flex items-center justify-center gap-2 flex-shrink-0 order-first md:order-none"},Ge={class:"hidden md:flex items-center justify-end gap-2 flex-shrink-0"},Ke={__name:"AppPlayer",setup(s){const a=be(),e=Re();let k=null;const m=h(!1),r=h(0);ne(()=>{k=setInterval(()=>{e.updateCurrentTime()},500)}),oe(()=>{k&&clearInterval(k)});const n=g=>{m.value=!0,r.value=Number(g.target.value)},y=g=>{m.value=!1,e.setCurrentTime(Number(g.target.value))},N=()=>{e.isPaused?e.resumeCurrentTrack():e.pauseCurrentTrack()},_=()=>{e.playNextTrack()},o=()=>{e.playPreviousTrack()},l=()=>{e.loopStatusToggle()},T=()=>{e.isMuted=!e.isMuted},b=()=>{e.likeToggle()},c=w(()=>e.currentLoopStatus===e.loopStatuses.SINGLE_TRACK?"LoopOneIcon":"LoopIcon"),f=w(()=>e.isLiked),v=w(()=>!(e.currentLoopStatus===e.loopStatuses.OFF&&e.isCurrentTrackFirst)),I=w(()=>!(e.currentLoopStatus===e.loopStatuses.OFF&&e.isCurrentTrackLast)),P=()=>{var g,p;(p=(g=e.currentTrackData)==null?void 0:g.album)!=null&&p.id&&a.push({name:"album",params:{albumId:e.currentTrackData.album.id}})},O=()=>{var g,p;(p=(g=e.currentTrackData)==null?void 0:g.author)!=null&&p.id&&a.push({name:"artist",params:{artistId:e.currentTrackData.author.id}})},q=async()=>{var p;if(!((p=e.currentTrackData)!=null&&p.id)){console.error("Нет данных о текущем треке для копирования ссылки.");return}const g=`${window.location.origin}/album/${e.currentTrackData.album.id}?trackId=${e.currentTrackData.id}`;try{await navigator.clipboard.writeText(g),console.log("Ссылка скопирована:",g)}catch(L){console.error("Ошибка при копировании ссылки:",L)}};return(g,p)=>{var A,z,M;const L=se("RouterLink");return u(e).isPlayerOpen?(R(),E("div",Oe,[d("input",{class:"h-1 w-full cursor-pointer",id:"progress",type:"range",min:0,max:u(e).audioDuration,step:"1",value:m.value?r.value:u(e).audioCurrentTime,onInput:n,onChange:y},null,40,Ae),d("div",ze,[d("div",Me,[d("div",$e,[i(ce,{url:(M=(z=(A=u(e))==null?void 0:A.currentTrackData)==null?void 0:z.album)==null?void 0:M.imageURL},null,8,["url"])]),d("div",Ee,[i(L,{to:{name:"album",params:{albumId:u(e).currentTrackData.album.id}},class:"min-w-0"},{default:D(()=>[d("span",Ue,U(u(e).currentTrackData.title),1)]),_:1},8,["to"]),i(L,{to:{name:"artist",params:{artistId:u(e).currentTrackData.author.id}},class:"min-w-0"},{default:D(()=>[d("span",Be,U(u(e).currentTrackData.author.displayName),1)]),_:1},8,["to"])]),d("div",qe,[i(F,{onClick:b,type:"text",size:"2xl",iconName:u(e).isLiked?"FavoriteFillIcon":"FavoriteIcon",title:u(e).isLiked?"Нравится":"Не нравится"},null,8,["iconName","title"]),i(ue,{placement:"top-right"},{trigger:D(()=>[i(F,{type:"text",size:"2xl",iconName:"MoreHorizIcon"})]),content:D(()=>[i(S,{onClick:b,iconName:f.value?"FavoriteFillIcon":"FavoriteIcon",text:f.value?"Нравится":"Не нравится"},null,8,["iconName","text"]),i(S,{onClick:P,iconName:"ArrowTopRightIcon",text:"Перейти к альбому"}),i(S,{onClick:O,iconName:"ArrowTopRightIcon",text:"Перейти к исполнителю"}),i(S,{onClick:q,iconName:"ShareIcon",text:"Копировать ссылку"})]),_:1})])]),d("div",je,[i(F,{onClick:o,action:v.value?"default":"disabled",disabled:!v.value,type:"text",size:"6xl",iconName:"PreviousArrowIcon"},null,8,["action","disabled"]),i(F,{onClick:N,type:"text",size:"6xl",iconName:u(e).isPaused?"PlayCircleIcon":"PauseCircleIcon"},null,8,["iconName"]),i(F,{onClick:_,type:"text",action:I.value?"default":"disabled",disabled:!I.value,size:"6xl",iconName:"NextArrowIcon"},null,8,["action","disabled"])]),d("div",Ge,[i(F,{onClick:l,type:"text",size:"2xl",action:u(e).currentLoopStatus===u(e).loopStatuses.OFF?"disabled":"default",iconName:c.value},null,8,["action","iconName"]),i(F,{onClick:T,type:"text",size:"2xl",iconName:u(e).isMuted?"VolumeOffIcon":"VolumeUpIcon"},null,8,["iconName"]),H(d("input",{id:"volume",type:"range",min:"0",max:"1",step:"0.01",class:"w-28 h-1 cursor-pointer","onUpdate:modelValue":p[0]||(p[0]=B=>u(e).volume=B)},null,512),[[_e,u(e).volume,void 0,{number:!0}]])])])])):me("",!0)}}},Ve={class:"flex h-screen overflow-hidden"},We={class:"flex flex-col flex-1"},He={class:"flex-1 overflow-y-auto overflow-x-hidden bg-white dark:bg-main-black container p-8 mx-auto"},et={__name:"UserLayout",setup(s){return(a,e)=>(R(),E("div",Ve,[i(Fe),d("div",We,[d("main",He,[Ce(a.$slots,"default")]),i(Ke)])]))}};export{et as _,Re as a,F as b,De as u};
