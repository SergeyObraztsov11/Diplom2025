import{u as N,o as l,h as n,l as F,Q as O,d as a,t as i,y as q,aa as Q,r as c,q as V,n as T,c as A,w as z,p as j,g as S,ab as M,i as y,F as x,f as E,_ as I,v as P,j as G}from"./index-CN2P0J7B.js";import{F as H}from"./fuse-CcLD0YPK.js";const J={class:"container bg-main-black h-screen overflow-y-auto overflow-x-hidden mx-auto"},K={__name:"AdminPanelLayout",setup(r){return N(),(v,w)=>(l(),n("div",J,[F(v.$slots,"default")]))}},W={class:"hover:bg-main-black/50 transition-colors"},X={class:"p-4 text-main-white/80 text-center"},Y={class:"p-4 text-main-white/80 text-center"},Z={class:"p-4"},ee={class:"p-4 text-main-white/80 text-center"},te={class:"p-4 text-main-white/80 text-center"},ae={__name:"ReportTableRow",props:{report:{type:Object,required:!0}},setup(r){const v=r,w=O(),p={comment:"Комментарий",album:"Альбом",user:"Пользователь"},b={pending:"Ожидает",resolved:"Решено",rejected:"Отклонено"},h={spam:"Спам",rules:"Нарушение правил",content:"Запрещенный контент"},d=(u,k)=>k[u]||u,_=u=>u?u.toDate?u.toDate().toLocaleDateString():u.toLocaleDateString():"-",C=()=>{w.openModal("reportAction",{report:v.report})};return(u,k)=>(l(),n("tr",W,[a("td",X,i(d(r.report.type,p)),1),a("td",Y,i(d(r.report.reason,h)),1),a("td",Z,[a("div",{class:q(["flex w-fit px-1 rounded-full mx-auto",{"bg-yellow-500/20 text-yellow-500":r.report.status==="pending","bg-green-500/20 text-green-500":r.report.status==="resolved","bg-red-500/20 text-red-500":r.report.status==="rejected"}])},i(d(r.report.status,b)),3)]),a("td",ee,i(_(r.report.createdAt)),1),a("td",te,i(_(r.report.resolvedAt)),1),a("td",{class:"p-4"},[a("button",{onClick:C,class:"mx-auto flex px-4 py-2 bg-main-white/10 hover:bg-main-white/20 text-main-white rounded-lg transition-colors"}," Обработать ")])]))}},se={class:"flex flex-row items-end justify-between px-8 py-4"},oe={class:"flex gap-4 px-8 py-4"},le=["value"],re=["value"],ne=["value"],ie={class:"flex flex-row h-10 items-center gap-2 p-2 border-2 border-main-gray text-main-gray rounded-full transition-colors focus-within:border-main-white focus-within:bg-main-gray focus-within:text-main-white"},ue={key:0,class:"px-8 py-4"},de={key:1,class:"px-8 py-4 text-red-500"},ce={key:2,class:"px-8 py-4 overflow-x-auto"},ve={class:"min-w-full bg-main-gray border-2 border-main-white/50 rounded-lg shadow-lg overflow-hidden"},pe={class:"bg-main-black/50"},me=["onClick"],be={class:"flex flex-row justify-center"},he={class:"truncate"},fe={key:0,class:"ml-1"},ge={class:"divide-y divide-main-white/20"},we={__name:"index",setup(r){const v=N(),w=Q(),p=c([]),b=c(!1),h=c(null),d=c(""),_=V(()=>new H(p.value,{keys:["description","reason","type","targetData.displayName","targetData.title","targetData.text","reporterData.displayName","resolvedByData.displayName"],threshold:.3,includeScore:!0,minMatchCharLength:2})),C=async()=>{try{b.value=!0,p.value=await w.fetchReports(),console.log(p.value)}catch(s){h.value="Ошибка при загрузке жалоб",console.error(s)}finally{b.value=!1}};T(()=>{C()});const u=[{value:"comment",label:"Комментарии"},{value:"album",label:"Альбомы"},{value:"user",label:"Пользователи"}],k=[{value:"pending",label:"Ожидает"},{value:"resolved",label:"Решено"},{value:"rejected",label:"Отклонено"}],B=[{value:"spam",label:"Спам"},{value:"rules",label:"Нарушение правил"},{value:"content",label:"Запрещенный контент"},{value:"other",label:"Другое"}],o=c({type:"",status:"",reason:""}),f=c("createdAt"),g=c("desc"),L=V(()=>{let s=[...p.value];return d.value&&(s=_.value.search(d.value).map(e=>e.item)),o.value.type&&(s=s.filter(e=>e.type===o.value.type)),o.value.status&&(s=s.filter(e=>e.status===o.value.status)),o.value.reason&&(s=s.filter(e=>e.reason===o.value.reason)),s.sort((e,t)=>{const m=e[f.value],$=t[f.value];return g.value==="asc"?m>$?1:-1:m<$?1:-1}),s}),D=(s,e)=>{o.value[s]=e},R=s=>{f.value===s?g.value=g.value==="asc"?"desc":"asc":(f.value=s,g.value="asc")},U={type:"Тип",reason:"Причина",status:"Статус",createdAt:"Дата создания",resolvedAt:"Дата решения",actions:"Действия"};return(s,e)=>(l(),A(K,null,{default:z(()=>[a("div",se,[e[8]||(e[8]=a("h1",{class:"text-nowrap text-2xl font-semibold"}," Панель администратора ",-1)),a("button",{class:"text-main-white/50 hover:text-main-white transition underline",onClick:e[0]||(e[0]=(...t)=>j(v).logoutUser&&j(v).logoutUser(...t))}," Выход ")]),a("div",oe,[S(a("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>o.value.type=t),onChange:e[2]||(e[2]=t=>D("type",t.target.value)),class:"bg-main-black focus:bg-main-gray h-10 p-2 border-2 border-main-gray focus:border-main-white transition-colors rounded-lg"},[e[9]||(e[9]=a("option",{value:""},"Все типы",-1)),(l(),n(x,null,y(u,t=>a("option",{key:t.value,value:t.value},i(t.label),9,le)),64))],544),[[M,o.value.type]]),S(a("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>o.value.status=t),onChange:e[4]||(e[4]=t=>D("status",t.target.value)),class:"bg-main-black focus:bg-main-gray h-10 p-2 border-2 border-main-gray focus:border-main-white transition-colors rounded-lg"},[e[10]||(e[10]=a("option",{value:""},"Все статусы",-1)),(l(),n(x,null,y(k,t=>a("option",{key:t.value,value:t.value},i(t.label),9,re)),64))],544),[[M,o.value.status]]),S(a("select",{"onUpdate:modelValue":e[5]||(e[5]=t=>o.value.reason=t),onChange:e[6]||(e[6]=t=>D("reason",t.target.value)),class:"bg-main-black focus:bg-main-gray h-10 p-2 border-2 border-main-gray focus:border-main-white transition-colors rounded-lg"},[e[11]||(e[11]=a("option",{value:""},"Все причины",-1)),(l(),n(x,null,y(B,t=>a("option",{key:t.value,value:t.value},i(t.label),9,ne)),64))],544),[[M,o.value.reason]]),a("div",ie,[E(I,{iconName:"SearchIcon",class:"fill-current h-5 w-5"}),S(a("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>d.value=t),placeholder:"Поиск",type:"text",spellcheck:"true",class:"w-full h-full outline-none bg-transparent text-main-white placeholder:text-main-white/50"},null,512),[[P,d.value]])])]),b.value?(l(),n("div",ue,"Загрузка жалоб...")):h.value?(l(),n("div",de,i(h.value),1)):(l(),n("div",ce,[a("table",ve,[a("thead",null,[a("tr",pe,[(l(),n(x,null,y(U,(t,m)=>a("th",{key:m,onClick:$=>R(m),class:"p-4 border-b border-main-white/20 text-main-white font-semibold uppercase tracking-wider cursor-pointer hover:bg-main-black/70 transition-colors"},[a("div",be,[a("span",he,i(t),1),f.value===m?(l(),n("span",fe,i(g.value==="asc"?"↑":"↓"),1)):G("",!0)])],8,me)),64))])]),a("tbody",ge,[(l(!0),n(x,null,y(L.value,t=>(l(),A(ae,{key:t.id,report:t},null,8,["report"]))),128))])])]))]),_:1}))}};export{we as default};
