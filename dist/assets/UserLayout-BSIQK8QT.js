import{u as J,a2 as ve,Q as fe,r as x,n as ne,a3 as oe,b as se,o as D,h as $,d as v,F as xe,i as pe,c as ie,w as L,f as c,_ as le,g as H,t as M,a1 as Y,y as X,x as ce,p as f,R as F,S as ue,a4 as he,O as de,P as ke,q as k,D as j,a5 as Z,a6 as ge,a7 as ye,J as G,I as K,E as ee,G as te,a8 as ae,H as V,j as me,k as we,a9 as Te,a as be,v as _e,l as Ce}from"./index-C5SE_L3X.js";const Ie={class:"flex flex-col w-full items-center"},Ne={class:"flex flex-row w-full items-center justify-center mt-auto"},Se={class:"h-10 w-10 overflow-hidden rounded-full flex-shrink-0"},W=80,Le=300,re=140,Fe={__name:"AppHeader",setup(l){const r=J();ve();const e=fe(),g=x([{icon:"HomeIcon",text:"Главная",to:{name:"home"}},{icon:"SearchIcon",text:"Поиск",to:{name:"search"}},{icon:"FavoriteFillIcon",text:"Мне нравится",to:{name:"liked_tracks"}},{icon:"MessageIcon",text:"Сообщения",to:{name:"chats-empty"}}]),s=x(80),n=x(!1),u=()=>{e.openModal("profile")},y=()=>{e.openModal("createAlbum")},C=async()=>{await r.logoutUser()},w=i=>{i.preventDefault();const T=i.clientX,b=s.value;function a(I){const R=b+(I.clientX-T);s.value=Math.min(Math.max(R,W),Le),n.value=s.value>re}function d(){document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",d),s.value<re?(s.value=W,n.value=!1):(s.value=Math.max(s.value,240),n.value=!0)}document.addEventListener("mousemove",a),document.addEventListener("mouseup",d)},o=()=>{window.innerWidth<768&&(s.value=W,n.value=!1)};return ne(()=>{o(),window.addEventListener("resize",o)}),oe(()=>{window.removeEventListener("resize",o)}),(i,T)=>{const b=se("RouterLink");return D(),$("header",{class:"h-screen flex flex-col px-2 items-center dark:bg-main-black select-none relative divide-y-2 divide-main-gray",style:he({width:`${s.value}px`})},[v("div",{class:"absolute right-0 top-0 h-full w-1 cursor-col-resize bg-main-gray hover:bg-main-white/20 transition-all",onMousedown:w},null,32),v("nav",Ie,[(D(!0),$(xe,null,pe(g.value,a=>(D(),ie(b,{key:a.to.name,to:a.to,title:a.text,class:X(["flex flex-row h-16 w-full text-base items-center gap-4 hover:text-white font-medium p-2 transition-all rounded-xl",[{"justify-center":!n.value},i.$route.name===a.to.name?"text-white bg-main-gray/20":"text-main-white/50"]])},{default:L(()=>[c(le,{iconName:a.icon,class:"fill-current h-6 w-6"},null,8,["iconName"]),H(v("span",{class:"truncate font-medium"},M(a.text),513),[[Y,n.value]])]),_:2},1032,["to","title","class"]))),128))]),v("div",Ne,[c(ue,{placement:"top-right",class:"w-full"},{trigger:L(()=>{var a,d;return[v("button",{class:X(["flex flex-row h-16 w-full text-base items-center justify-center gap-4 text-main-white/80 hover:text-white font-medium p-2 transition-all rounded-xl",{"justify-center":!n.value}])},[v("div",Se,[c(ce,{loadingIcon:"user",url:(a=f(r).currentUserData)==null?void 0:a.imageURL},null,8,["url"])]),H(v("span",{class:"truncate transition-all"},M((d=f(r).currentUserData)==null?void 0:d.displayName),513),[[Y,n.value]])],2)]}),content:L(()=>[c(F,{onClick:u,iconName:"PersonIcon",text:"Профиль"}),c(F,{onClick:y,iconName:"AddIcon",text:"Создать альбом"}),c(F,{onClick:C,isRed:!0,iconName:"LogoutIcon",text:"Выход"})]),_:1})])],4)}}},De=de("tracks",()=>{const l=ke(),r=J(),e=async o=>{const i=j(l,"users",r.currentUserId);await Z(i,{likedTracks:ge(o)})},g=async o=>{const i=j(l,"users",r.currentUserId);await Z(i,{likedTracks:ye(o)})},s=k(()=>{var o;return((o=r.currentUserData)==null?void 0:o.likedTracks)||[]}),n=async o=>{const i=o.data(),T=o.id,b=await G(i.author),a={id:b.id,...b.data()},d=await G(i.album),I={id:d.id,...d.data()};return{id:T,ref:o.ref,...i,author:a,album:I}};return{likedTracks:s,likeTrack:e,dislikeTrack:g,getLikedTracks:async()=>{const o=s.value;if(!(o.length>0))return[];const i=await K(ee(V(l,"tracks"),te(ae(),"in",o)));return i.empty?[]:await Promise.all(i.docs.map(n))},getTrackById:async o=>{const i=j(l,"tracks",o),T=await G(i);return await n(T)},getTracksById:async o=>{const i=await K(ee(V(l,"tracks"),te(ae(),"in",o)));return i.empty?[]:await Promise.all(i.docs.map(n))},getTrackDetails:n,getAllTracks:async()=>{const o=await K(V(l,"tracks"));return await Promise.all(o.docs.map(n))}}}),Re=de("player",()=>{const l=De(),r=J(),e=x(!1),g=x(!0),s=x(null),n=x([]),u=x(new Audio),y=x(!1),C=x(!1),w=k(()=>{var t;return n.value.indexOf((t=s.value)==null?void 0:t.id)}),o=k(()=>!n.value||!s.value?!1:w.value===n.value.length-1),i=k(()=>!n.value||!s.value?!1:w.value===0),T=k(()=>{var t,m;return s.value?(m=(t=r.currentUserData)==null?void 0:t.likedTracks)==null?void 0:m.includes(s.value.id):!1}),b=async()=>{const t=s.value.id;T.value?await l.dislikeTrack(t):await l.likeTrack(t)},a={OFF:"OFF",ON:"ON",SINGLE_TRACK:"SINGLE_TRACK"},d=x(a.OFF),I=()=>{switch(d.value){case a.OFF:{d.value=a.ON;break}case a.ON:{d.value=a.SINGLE_TRACK;break}case a.SINGLE_TRACK:{d.value=a.OFF;break}default:{d.value=a.OFF;break}}},R=async({id:t,trackList:m})=>{n.value=m,p(t||m[0])},E=()=>{const t=w.value,m=o.value,_=d.value,z=q(t,m,_);z!==null&&p(n.value[z])},B=()=>{const t=w.value,m=i.value,_=d.value,z=h(t,m,_);z!==null&&p(n.value[z])},q=(t,m,_)=>_===a.SINGLE_TRACK?t:_===a.ON?m?0:t+1:_===a.OFF&&!m?t+1:null,h=(t,m,_)=>_===a.SINGLE_TRACK?t:_===a.ON?m?n.value.length-1:t-1:_===a.OFF?m?null:t-1:(console.log("Достигнуто начало плейлиста"),null),p=async t=>{g.value=!0;try{const m=await l.getTrackById(t);m&&(s.value=m,e.value=!0,u.value.src=m.audioURL,u.value.addEventListener("ended",()=>E()),u.value.load(),await u.value.play(),y.value=!1)}catch{y.value=!0}finally{g.value=!1}},N=x(0),P=x(0),O=x(!1),A=k({get:()=>O.value,set:t=>{u.value.volume=t?0:Q.value,O.value=t}}),U=x(.5),Q=k({get:()=>U.value,set:t=>{u.value&&(u.value.volume=t),A.value=!1,U.value=t}});return{isCurrentTrackFirst:i,isCurrentTrackLast:o,currentTrackIndex:w,isLiked:T,likeToggle:b,isPlayerOpen:e,currentTrackData:s,isLoading:g,isPaused:y,volume:Q,isShuffle:C,playTrack:p,pauseCurrentTrack:()=>{u.value&&(u.value.pause(),y.value=!0)},resumeCurrentTrack:()=>{u.value&&(u.value.play(),y.value=!1)},updateCurrentTime:()=>{u.value&&(N.value=u.value.currentTime,P.value=u.value.duration)},audioDuration:P,audioCurrentTime:N,setCurrentTime:t=>{u.value.currentTime=t},playTrackList:R,playNextTrack:E,playPreviousTrack:B,isMuted:A,currentLoopStatus:d,loopStatuses:a,loopStatusToggle:I}}),Pe=["type"],S={__name:"BaseButton",props:{type:{type:String,validator:l=>["default","primary","text","hovering"].some(r=>r===l),default:"default",required:!1},action:{type:String,validator:l=>["default","disabled","danger"].some(r=>r===l),default:"default",required:!1},isRounded:{type:Boolean,default:!1,required:!1},iconName:{type:String,required:!1},text:{type:String,required:!1},size:{type:String,validator:l=>["xs","sm","md","lg","xl","2xl","3xl","4xl","5xl","6xl"].includes(l),default:"md",required:!1},formType:{type:String,validator:l=>["button","submit","reset"].some(r=>r===l),default:"button",required:!1},isReversed:{type:Boolean,default:!1,required:!1}},setup(l){const r=l,e={default:{primary:"text-white dark:text-main-white border-main-color bg-main-color hover:bg-main-color/90",default:"border-main-white dark:border-main-gray hover:bg-main-white dark:hover:bg-main-gray",hovering:"border-transparent  hover:bg-main-white dark:hover:bg-main-gray",text:"text-main-gray dark:text-main-white hover:text-main-gray/60 dark:hover:text-main-white/60 border-transparent"},danger:{primary:"text-white dark:text-main-white border-main-error-red bg-main-error-red hover:bg-main-error-red/90",default:"text-main-error-red border-main-error-red hover:bg-main-white dark:hover:bg-main-gray",hovering:"text-main-error-red border-transparent  hover:bg-main-white dark:hover:bg-main-gray",text:"text-main-error-red hover:text-main-error-red/60 border-transparent"},disabled:{primary:"text-white dark:text-main-black border-main-white dark:border-main-gray bg-main-white dark:bg-main-gray",default:"text-main-white dark:text-main-gray border-main-white dark:border-main-gray ",hovering:"text-main-white dark:text-main-gray border-transparent",text:"text-main-white dark:text-main-white/50 border-transparent"}},g={xs:{text:"text-xs",icon:"h-3 w-3"},sm:{text:"text-sm",icon:"h-4 w-4"},md:{text:"text-base",icon:"h-5 w-5"},lg:{text:"text-lg",icon:"h-6 w-6"},xl:{text:"text-xl",icon:"h-7 w-7"},"2xl":{text:"text-2xl",icon:"h-8 w-8"},"3xl":{text:"text-3xl",icon:"h-9 w-9"},"4xl":{text:"text-4xl",icon:"h-10 w-10"},"5xl":{text:"text-5xl",icon:"h-11 w-11"},"6xl":{text:"text-6xl",icon:"h-14 w-14"}},s=k(()=>e[r.action][r.type]),n=k(()=>r.isRounded?"rounded-full":"rounded-lg"),u=k(()=>g[r.size].text),y=k(()=>g[r.size].icon);return(C,w)=>(D(),$("button",Te(C.$attrs,{class:["flex flex-row items-center justify-start max-w-full p-2 gap-1 border-2 transition-all truncate overflow-hidden whitespace-nowrap",[n.value,s.value,u.value,{"hover:scale-105":r.action!=="disabled"},{"flex-row-reverse":l.isReversed}]],type:r.formType}),[r.iconName?(D(),ie(le,{key:0,iconName:r.iconName,class:X(["fill-current",[y.value]])},null,8,["iconName","class"])):me("",!0),we(" "+M(r.text),1)],16,Pe))}},Oe={key:0,class:"sticky bottom-0 left-0 right-0 bg-white dark:bg-main-black z-10 backdrop-blur-sm"},Ae=["max","value"],ze={class:"flex flex-row items-center p-2 gap-4 md:grid md:grid-cols-[1fr_auto_1fr] md:gap-2"},$e={class:"flex items-center gap-2 flex-grow md:flex-grow-0 min-w-0 md:min-w-[180px]"},Me={class:"h-20 w-20 rounded-md overflow-hidden flex-shrink-0"},Ee={class:"flex flex-col justify-center min-w-0"},Ue={class:"font-semibold text-lg truncate block hover:text-white"},Be={class:"truncate block hover:underline"},qe={class:"flex items-center gap-1 flex-shrink-0 ml-auto md:ml-0"},je={class:"flex items-center justify-center gap-2 flex-shrink-0 order-first md:order-none"},Ge={class:"hidden md:flex items-center justify-end gap-2 flex-shrink-0"},Ke={__name:"AppPlayer",setup(l){const r=be(),e=Re();let g=null;const s=x(!1),n=x(0);ne(()=>{g=setInterval(()=>{e.updateCurrentTime()},500)}),oe(()=>{g&&clearInterval(g)});const u=h=>{s.value=!0,n.value=Number(h.target.value)},y=h=>{s.value=!1,e.setCurrentTime(Number(h.target.value))},C=()=>{e.isPaused?e.resumeCurrentTrack():e.pauseCurrentTrack()},w=()=>{e.playNextTrack()},o=()=>{e.playPreviousTrack()},i=()=>{e.loopStatusToggle()},T=()=>{e.isMuted=!e.isMuted},b=()=>{e.likeToggle()},a=k(()=>e.currentLoopStatus===e.loopStatuses.SINGLE_TRACK?"LoopOneIcon":"LoopIcon"),d=k(()=>e.isLiked),I=k(()=>!(e.currentLoopStatus===e.loopStatuses.OFF&&e.isCurrentTrackFirst)),R=k(()=>!(e.currentLoopStatus===e.loopStatuses.OFF&&e.isCurrentTrackLast)),E=()=>{var h,p;(p=(h=e.currentTrackData)==null?void 0:h.album)!=null&&p.id&&r.push({name:"album",params:{albumId:e.currentTrackData.album.id}})},B=()=>{var h,p;(p=(h=e.currentTrackData)==null?void 0:h.author)!=null&&p.id&&r.push({name:"artist",params:{artistId:e.currentTrackData.author.id}})},q=async()=>{var p;if(!((p=e.currentTrackData)!=null&&p.id)){console.error("Нет данных о текущем треке для копирования ссылки.");return}const h=`${window.location.origin}/album/${e.currentTrackData.album.id}?trackId=${e.currentTrackData.id}`;try{await navigator.clipboard.writeText(h),console.log("Ссылка скопирована:",h)}catch(N){console.error("Ошибка при копировании ссылки:",N)}};return(h,p)=>{var P,O,A;const N=se("RouterLink");return f(e).isPlayerOpen?(D(),$("div",Oe,[v("input",{class:"h-1 w-full cursor-pointer",id:"progress",type:"range",min:0,max:f(e).audioDuration,step:"1",value:s.value?n.value:f(e).audioCurrentTime,onInput:u,onChange:y},null,40,Ae),v("div",ze,[v("div",$e,[v("div",Me,[c(ce,{url:(A=(O=(P=f(e))==null?void 0:P.currentTrackData)==null?void 0:O.album)==null?void 0:A.imageURL},null,8,["url"])]),v("div",Ee,[c(N,{to:{name:"album",params:{albumId:f(e).currentTrackData.album.id}},class:"min-w-0"},{default:L(()=>[v("span",Ue,M(f(e).currentTrackData.title),1)]),_:1},8,["to"]),c(N,{to:{name:"artist",params:{artistId:f(e).currentTrackData.author.id}},class:"min-w-0"},{default:L(()=>[v("span",Be,M(f(e).currentTrackData.author.displayName),1)]),_:1},8,["to"])]),v("div",qe,[c(S,{onClick:b,type:"text",size:"2xl",iconName:f(e).isLiked?"FavoriteFillIcon":"FavoriteIcon",title:f(e).isLiked?"Нравится":"Не нравится"},null,8,["iconName","title"]),c(ue,{placement:"top-right"},{trigger:L(()=>[c(S,{type:"text",size:"2xl",iconName:"MoreHorizIcon"})]),content:L(()=>[c(F,{onClick:b,iconName:d.value?"FavoriteFillIcon":"FavoriteIcon",text:d.value?"Нравится":"Не нравится"},null,8,["iconName","text"]),c(F,{onClick:E,iconName:"ArrowTopRightIcon",text:"Перейти к альбому"}),c(F,{onClick:B,iconName:"ArrowTopRightIcon",text:"Перейти к исполнителю"}),c(F,{onClick:q,iconName:"ShareIcon",text:"Копировать ссылку"})]),_:1})])]),v("div",je,[c(S,{onClick:o,action:I.value?"default":"disabled",disabled:!I.value,type:"text",size:"6xl",iconName:"PreviousArrowIcon"},null,8,["action","disabled"]),c(S,{onClick:C,type:"text",size:"6xl",iconName:f(e).isPaused?"PlayCircleIcon":"PauseCircleIcon"},null,8,["iconName"]),c(S,{onClick:w,type:"text",action:R.value?"default":"disabled",disabled:!R.value,size:"6xl",iconName:"NextArrowIcon"},null,8,["action","disabled"])]),v("div",Ge,[c(S,{onClick:i,type:"text",size:"2xl",action:f(e).currentLoopStatus===f(e).loopStatuses.OFF?"disabled":"default",iconName:a.value},null,8,["action","iconName"]),c(S,{onClick:T,type:"text",size:"2xl",iconName:f(e).isMuted?"VolumeOffIcon":"VolumeUpIcon"},null,8,["iconName"]),H(v("input",{id:"volume",type:"range",min:"0",max:"1",step:"0.01",class:"w-28 h-1 cursor-pointer","onUpdate:modelValue":p[0]||(p[0]=U=>f(e).volume=U)},null,512),[[_e,f(e).volume,void 0,{number:!0}]])])])])):me("",!0)}}},Ve={class:"flex flex-row h-screen overflow-hidden"},We={class:"flex flex-col flex-1"},He={class:"flex flex-col h-full overflow-y-auto container bg-main-black p-8 mx-auto"},et={__name:"UserLayout",setup(l){return(r,e)=>(D(),$("div",Ve,[c(Fe),v("div",We,[v("div",He,[Ce(r.$slots,"default")]),c(Ke)])]))}};export{et as _,Re as a,S as b,De as u};
