import{b as E,o as r,h as n,f as c,w as h,x as H,d as s,k as O,t as M,m as Q,V as J,r as x,q,n as K,z as W,c as _,a as X,B as Y,_ as w,g as Z,v as ee,i as k,p as $,y as te,F as S,j as A}from"./index-C5SE_L3X.js";import{u as se,_ as le}from"./UserLayout-BSIQK8QT.js";import{_ as ae}from"./Track-sVTIUyg5.js";import{_ as re}from"./AlbumCard-B4MOmbj8.js";import{C as B}from"./CardsGrid-ClbK23rf.js";import"./lodash-BUlOZx_2.js";import{F as ie}from"./fuse-CcLD0YPK.js";import{A as ne,S as oe,a as ue}from"./a11y-CGjrJTAs.js";import{M as ce}from"./mousewheel-BR5Qw9zw.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const de={class:"flex flex-col w-[250px] h-[300px] p-2 flex-shrink-0 hover:scale-105 transition-all"},me={class:"flex w-full items-center justify-center py-2"},fe={__name:"ArtistCard",props:{artist:{type:String,required:!0},artistId:{type:String,required:!0},imageURL:{type:String,default:null}},setup(I){const v=I;return(g,C)=>{const y=E("RouterLink");return r(),n("div",de,[c(y,{to:{name:"artist",params:{artistId:v.artistId}},class:"rounded-full overflow-hidden"},{default:h(()=>[c(H,{url:v.imageURL,loadingIcon:"user"},null,8,["url"])]),_:1},8,["to"]),s("div",me,[c(y,{to:{name:"artist",params:{artistId:v.artistId}},class:"text-main-black dark:text-white font-semibold truncate hover:underline underline-offset-1"},{default:h(()=>[O(M(v.artist),1)]),_:1},8,["to"])])])}}},pe={class:"flex h-full flex-col gap-4"},he={class:"flex flex-row h-12 w-full items-center gap-2 p-2 border-2 border-main-gray text-main-gray rounded-full transition-colors focus-within:border-main-white focus-within:bg-main-gray focus-within:text-main-white"},ve={class:"flex flex-col gap-4"},ge=["onClick"],xe={key:0,class:"flex-1 items-center justify-center"},_e={class:"flex flex-col items-center gap-4"},ye={key:1,class:"flex flex-1 h-full items-center justify-center"},be={class:"flex flex-col items-center gap-4"},we={key:2,class:"flex flex-col gap-6"},ke={key:0,class:"flex flex-col gap-2"},Se={key:1,class:"flex flex-col gap-2"},Re={key:2,class:"flex flex-col gap-2"},Ue={__name:"SearchPage",setup(I){const v=X(),g=Y(),C=se(),y=Q(),P=J(),U=[ne,ce],b=x(!0),f=x(""),R=x([]),o=x([]),F=x([{label:"Поп-музыка",value:"pop"},{label:"Рэп и хип-хоп",value:"rap-hip-hop"},{label:"Танцевальная",value:"dance"},{label:"Классическая",value:"classic"},{label:"Блюз",value:"blues"},{label:"Панк",value:"punk"},{label:"R&B",value:"r-b"},{label:"Другое",value:"other"}]),T=async()=>{const t=C.getAllTracks(),e=y.getAllAlbums(),i=P.getAllArtists(),[d,l,p]=await Promise.all([t,e,i]);R.value=[...d.map(m=>({...m,type:"track"})),...l.map(m=>({...m,type:"album"})),...p.map(m=>({...m,type:"artist"}))]},j=q(()=>new ie(R.value,{keys:[{name:"title",weight:.7},{name:"displayName",weight:.8},{name:"author.displayName",weight:.5},{name:"description",weight:.3},{name:"album.title",weight:.4},{name:"album.description",weight:.2},{name:"author.description",weight:.1}],threshold:.3,distance:100,minMatchCharLength:1,shouldSort:!0,includeMatches:!0,includeScore:!0})),u=q(()=>{let t=R.value;f.value.trim()&&(t=j.value.search(f.value).map(l=>l.item)),o.value.length>0&&(t=t.filter(l=>o.value.includes(l.genre)));const e=t.filter(l=>l.type==="track").slice(0,10),i=t.filter(l=>l.type==="album").slice(0,10),d=t.filter(l=>l.type==="artist").slice(0,10);return{tracks:e||[],albums:i||[],artists:d||[]}}),D=q(()=>{var t,e,i,d,l,p;return((e=(t=u.value)==null?void 0:t.artists)==null?void 0:e.length)>0||((d=(i=u.value)==null?void 0:i.tracks)==null?void 0:d.length)>0||((p=(l=u.value)==null?void 0:l.albums)==null?void 0:p.length)>0});K(async()=>{try{b.value=!0,g.query.request&&(f.value=g.query.request),g.query.genres&&(o.value=g.query.genres),await T()}catch(t){console.log(t)}finally{b.value=!1}});const G=()=>{f.value=""};W([f,o],([t,e])=>{const i={...g.query,request:t.trim()!==""?t:void 0,genres:e.length>0?e:void 0};v.replace({query:i})},{immediate:!1});const V=t=>{o.value.includes(t)?o.value=o.value.filter(e=>e!==t):o.value=[...o.value,t]},z=t=>o.value.includes(t);return(t,e)=>(r(),_(le,null,{default:h(()=>{var i,d,l,p,m,L;return[s("div",pe,[e[6]||(e[6]=s("div",null,[s("h1",{class:"text-4xl font-bold tracking-tight truncate"}," Поиск ")],-1)),s("div",he,[s("div",null,[c(w,{iconName:"SearchIcon",class:"fill-current h-6 w-6"})]),Z(s("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>f.value=a),type:"text",spellcheck:"false",class:"w-full h-full outline-none bg-transparent text-main-white placeholder:text-main-white/50",placeholder:"Треки, альбомы, исполнители"},null,512),[[ee,f.value]]),s("button",{onClick:G},[c(w,{iconName:"CloseIcon",class:"fill-current h-6 w-6"})])]),s("div",ve,[c($(oe),{"space-between":16,modules:U,"slides-per-view":"auto",class:"w-full",mousewheel:!0},{default:h(()=>[(r(!0),n(S,null,k(F.value,a=>(r(),_($(ue),{key:a.value,class:"!w-fit"},{default:h(()=>[s("button",{onClick:N=>V(a.value),class:te(["px-4 py-2 bg-main-gray rounded-full transition hover:scale-95",z(a.value)?"bg-main-white/20":"bg-main-gray"])},M(a.label),11,ge)]),_:2},1024))),128))]),_:1}),b.value?(r(),n("div",xe,[s("div",_e,[c(w,{iconName:"ProgressActivityIcon",class:"h-16 w-16 fill-current"}),e[1]||(e[1]=s("div",{class:"flex flex-col items-center gap-2"},[s("span",{class:"text-2xl font-bold"},"Загрузка...")],-1))])])):!b.value&&!D.value?(r(),n("div",ye,[s("div",be,[c(w,{iconName:"SearchOffIcon",class:"h-16 w-16 fill-current"}),e[2]||(e[2]=s("div",{class:"flex flex-col items-center gap-2"},[s("span",{class:"text-2xl font-bold"},"Ничего не найдено"),s("span",{class:"text-main-white/50"},"Попробуйте изменить запрос")],-1))])])):(r(),n("div",we,[((d=(i=u.value)==null?void 0:i.tracks)==null?void 0:d.length)>0?(r(),n("div",ke,[e[3]||(e[3]=s("h2",{class:"text-xl font-bold"},"Треки",-1)),(r(!0),n(S,null,k(u.value.tracks,a=>(r(),_(ae,{key:a.id,data:a,isShowImage:!0,list:u.value.tracks.map(N=>N.id)},null,8,["data","list"]))),128))])):A("",!0),((p=(l=u.value)==null?void 0:l.albums)==null?void 0:p.length)>0?(r(),n("div",Se,[e[4]||(e[4]=s("h2",{class:"text-xl font-bold"},"Альбомы",-1)),c(B,null,{default:h(()=>[(r(!0),n(S,null,k(u.value.albums,a=>(r(),_(re,{album:a,key:a.id},null,8,["album"]))),128))]),_:1})])):A("",!0),((L=(m=u.value)==null?void 0:m.artists)==null?void 0:L.length)>0?(r(),n("div",Re,[e[5]||(e[5]=s("h2",{class:"text-xl font-bold"},"Исполнители",-1)),c(B,null,{default:h(()=>[(r(!0),n(S,null,k(u.value.artists,a=>(r(),_(fe,{key:a.id,artist:a.displayName,artistId:a.id,imageURL:a.imageURL},null,8,["artist","artistId","imageURL"]))),128))]),_:1})])):A("",!0)]))])])]}),_:1}))}};export{Ue as default};
